# GCode Proxy Server Configuration
# 
# This file configures the GCode proxy server that forwards GCode commands
# from TCP clients to USB serial devices.
#
# Configuration precedence (highest to lowest):
# 1. Environment variables
# 2. CLI arguments
# 3. This config file
# 4. Default values
#
# Copy this file to ~/.config/gcode-proxy/config.yaml
# or specify a custom path with --config or GCODE_PROXY_CONFIG env variable

server:
  # TCP server port
  # Environment variable: SERVER_PORT
  port: 8080
  
  # TCP server bind address
  # Use 0.0.0.0 to listen on all interfaces
  # Use 127.0.0.1 to only accept local connections
  # Environment variable: SERVER_ADDRESS
  address: 0.0.0.0

device:
  # USB device ID in vendor:product format
  # Find your device ID using: lsusb (Linux) or Device Manager (Windows)
  # Environment variable: DEVICE_USB_ID
  usb-id: 303a:4001
  
  # Device path as alternative to usb-id, overrides usb-id
  # Environment variable: DEVICE_DEV_PATH
  #path: /dev/ttyACM0
  
  # Serial baud rate for the USB device
  # Common values: 9600, 19200, 38400, 57600, 115200, 250000
  # Environment variable: DEVICE_BAUD_RATE
  baud-rate: 115200
  
  # Device initialization delay in seconds
  # Some devices need time to initialize after connection
  # Environment variable: DEVICE_SERIAL_DELAY
  serial-delay: 0.1

# GCode communication log file
# Optional path to a file where all GCode commands sent to the device
# and responses received from the device will be logged.
# Log entries include timestamp and source (client address or 'device').
# If the file exists, new entries are appended to the end.
# Environment variable: GCODE_LOG_FILE
gcode-log-file: gcode.log

# Custom triggers for executing external commands in response to GCode patterns
# Triggers allow you to integrate external systems (scripts, Home Assistant, etc.)
# All trigger execution is asynchronous and non-blocking
# See TRIGGERS.md for detailed documentation
custom-triggers:
  # Example: Air assist on (M8 command)
  - id: air-assist-on
    trigger:
      type: gcode
      match: M8
    command: "hostname"
  
  # Example: Air assist off (M9 command)
  - id: air-assist-off
    trigger:
      type: gcode
      match: M9
    command: "./scripts/air_assist.py --state off"
